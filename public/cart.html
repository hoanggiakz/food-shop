<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Giá» hÃ ng ğŸ›’</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet">
  <link href="/css/style.css" rel="stylesheet">
</head>
<body>

<nav class="navbar px-3 mb-4">
  <a href="/" class="navbar-brand">â† Quay láº¡i shop</a>
</nav>

<div class="container">
  <h4 class="mb-3">ğŸ›’ Giá» hÃ ng cá»§a báº¡n</h4>

  <div id="cartItems"></div>

  <div class="product-card p-3 mt-4">
    <h5>ğŸ“¦ ThÃ´ng tin Ä‘áº·t hÃ ng</h5>

    <input id="name" class="form-control my-2" placeholder="Há» vÃ  tÃªn">
    <input id="email" class="form-control my-2" placeholder="Email">

    <button class="btn btn-buy w-100 mt-3" onclick="checkout()">
      Äáº¶T HÃ€NG NGAY
    </button>
  </div>
</div>

<script>
function loadCart() {
  fetch('/cart')
    .then(r => r.json())
    .then(cart => {
      if (!cart || cart.items.length === 0) {
        cartItems.innerHTML = '<p>ğŸ«™ Giá» hÃ ng trá»‘ng</p>';
        return;
      }

      let html = cart.items.map((i, idx) => `
        <div class="product-card p-3 mb-3">
          <div class="d-flex justify-content-between">
            <div>
              <b>${i.name}</b><br>
              ${i.price.toLocaleString()}Ä‘ x ${i.quantity}
            </div>
            <button class="btn btn-sm btn-danger"
              onclick="removeItem(${idx})">âœ•</button>
          </div>
        </div>
      `).join('');

      html += `<h5 class="text-end mt-3">
        Tá»•ng: <span class="product-price">${cart.total.toLocaleString()}Ä‘</span>
      </h5>`;

      cartItems.innerHTML = html;
    });
}

function removeItem(index) {
  fetch('/cart/remove', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ index })
  }).then(loadCart);
}

function checkout() {
  fetch('/cart/checkout', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
      name: name.value,
      email: email.value
    })
  }).then(r => r.text())
    .then(msg => {
      alert('ğŸ‰ Äáº·t hÃ ng thÃ nh cÃ´ng!');
      location.href = '/';
    });
}

loadCart();
</script>

</body>
</html>
